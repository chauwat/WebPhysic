<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select-Vehicle</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mitr">
</head>

<body>
    <script type="module">
        import * as THREE from './build/three.module.js';
        import { OrbitControls } from './jsm/controls/OrbitControls.js';


        // create formulaOne model
        function init_formulaone() {
            var container = document.getElementById('formulaone');
            var scene = new THREE.Scene();
            scene.background = new THREE.Color(0xbbdefb);
            var chassisSize = [8, 5, 2];
            var radius = 1;

            var camera = new THREE.PerspectiveCamera(60, container.clientWidth / container.clientHeight, 1, 1000);
            camera.position.set(20, 20, 8);
            camera.up.set(0, 0, 1);
            scene.add(camera);
            window.addEventListener('resize', () => {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
            });

            const ground = new THREE.PlaneGeometry(20, 20, 4, 4);
            const ground_material = new THREE.MeshStandardMaterial({ color: 0xccf0cc });
            const ground_mesh = new THREE.Mesh(ground, ground_material);
            ground_mesh.castShadow = true;
            ground_mesh.receiveShadow = true;
            scene.add(ground_mesh);

            const dirLight1 = new THREE.DirectionalLight(0xffffff);
            dirLight1.position.set(1, 1, 1);
            scene.add(dirLight1);
            const ambientLight = new THREE.AmbientLight(0x222222);
            scene.add(ambientLight);

            const dirLight3 = new THREE.DirectionalLight(0xfffff0, 0.4, 1);
            dirLight3.position.set(3, 12, 15);
            dirLight3.castShadow = true;
            dirLight3.shadow.camera.near = 0.1;
            dirLight3.shadow.camera.far = 500;
            dirLight3.shadow.camera.right = 32;
            dirLight3.shadow.camera.left = - 32;
            dirLight3.shadow.camera.top = 32;
            dirLight3.shadow.camera.bottom = - 32;
            dirLight3.shadow.mapSize.width = 512;
            dirLight3.shadow.mapSize.height = 512;
            dirLight3.shadow.radius = 4;
            dirLight3.shadow.bias = - 0.0005;
            scene.add(dirLight3);

            var geometry = new THREE.BoxGeometry(...chassisSize);
            var material = new THREE.MeshLambertMaterial({ color: 0xfec89a });
            var chassisMesh = new THREE.Mesh(geometry, material);
            chassisMesh.castShadow = true;
            chassisMesh.receiveShadow = true;
            chassisMesh.position.set(0, 0, 2);
            scene.add(chassisMesh);

            function gen_wheel(...pos) {
                var geometry = new THREE.CylinderGeometry(radius, radius, radius / 2, 20);
                var material = new THREE.MeshPhongMaterial({ color: 0xEED6C4 });
                var wheelMesh = new THREE.Mesh(geometry, material);
                wheelMesh.geometry.rotateX(Math.PI);
                wheelMesh.castShadow = true;
                wheelMesh.receiveShadow = true;
                wheelMesh.position.set(...pos);
                scene.add(wheelMesh);
            }
            gen_wheel(-(chassisSize[0] / 2 - radius * 1.25), chassisSize[1] / 2, 1);
            gen_wheel((chassisSize[0] / 2 - radius * 1.25), chassisSize[1] / 2, 1);
            gen_wheel(-(chassisSize[0] / 2 - radius * 1.25), -chassisSize[1] / 2, 1);
            gen_wheel((chassisSize[0] / 2 - radius * 1.25), -chassisSize[1] / 2, 1);

            var renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.VSMShadowMap;
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer.domElement);
            window.addEventListener('resize', () => {
                renderer.setSize(container.clientWidth, container.clientHeight);
            });
            var controls = new OrbitControls(camera, renderer.domElement);

            animate();
            function animate() {
                requestAnimationFrame(animate);
                if (controls) controls.update(); // only required if controls.enableDamping = true, or if controls.autoRotate = true
                renderer.render(scene, camera);
            }
        }

        // create truck model
        function init_truck() {
            var container = document.getElementById('truck');
            var scene = new THREE.Scene();
            scene.background = new THREE.Color(0xbbdefb);
            var chassisSize = [12, 5, 5];
            var radius = 2.2;

            var camera = new THREE.PerspectiveCamera(60, container.clientWidth / container.clientHeight, 1, 1000);
            camera.position.set(20, 20, 8);
            camera.up.set(0, 0, 1);
            scene.add(camera);
            window.addEventListener('resize', () => {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
            });

            const ground = new THREE.PlaneGeometry(20, 20, 4, 4);
            const ground_material = new THREE.MeshStandardMaterial({ color: 0xccf0cc });
            const ground_mesh = new THREE.Mesh(ground, ground_material);
            ground_mesh.castShadow = true;
            ground_mesh.receiveShadow = true;
            scene.add(ground_mesh);

            const dirLight1 = new THREE.DirectionalLight(0xffffff);
            dirLight1.position.set(1, 1, 1);
            scene.add(dirLight1);
            const ambientLight = new THREE.AmbientLight(0x222222);
            scene.add(ambientLight);

            const dirLight3 = new THREE.DirectionalLight(0xfffff0, 0.4, 1);
            dirLight3.position.set(3, 12, 15);
            dirLight3.castShadow = true;
            dirLight3.shadow.camera.near = 0.1;
            dirLight3.shadow.camera.far = 500;
            dirLight3.shadow.camera.right = 32;
            dirLight3.shadow.camera.left = - 32;
            dirLight3.shadow.camera.top = 32;
            dirLight3.shadow.camera.bottom = - 32;
            dirLight3.shadow.mapSize.width = 512;
            dirLight3.shadow.mapSize.height = 512;
            dirLight3.shadow.radius = 4;
            dirLight3.shadow.bias = - 0.0005;
            scene.add(dirLight3);

            var geometry = new THREE.BoxGeometry(...chassisSize);
            var material = new THREE.MeshLambertMaterial({ color: 0xfffff8 });
            var chassisMesh = new THREE.Mesh(geometry, material);
            chassisMesh.castShadow = true;
            chassisMesh.receiveShadow = true;
            chassisMesh.position.set(0, 0, chassisSize[2] / 2 + radius);
            scene.add(chassisMesh);

            function gen_wheel(...pos) {
                var geometry = new THREE.CylinderGeometry(radius, radius, radius / 2, 20);
                var material = new THREE.MeshPhongMaterial({ color: 0x000000 });
                var wheelMesh = new THREE.Mesh(geometry, material);
                wheelMesh.geometry.rotateX(Math.PI);
                wheelMesh.castShadow = true;
                wheelMesh.receiveShadow = true;
                wheelMesh.position.set(...pos);
                scene.add(wheelMesh);
            }
            gen_wheel(-(chassisSize[0] / 2 - radius * 1.25), chassisSize[1] / 2, radius);
            gen_wheel((chassisSize[0] / 2 - radius * 1.25), chassisSize[1] / 2, radius);
            gen_wheel(-(chassisSize[0] / 2 - radius * 1.25), -chassisSize[1] / 2, radius);
            gen_wheel((chassisSize[0] / 2 - radius * 1.25), -chassisSize[1] / 2, radius);

            var renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.VSMShadowMap;
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer.domElement);
            window.addEventListener('resize', () => {
                renderer.setSize(container.clientWidth, container.clientHeight);
            });
            var controls = new OrbitControls(camera, renderer.domElement);

            animate();
            function animate() {
                requestAnimationFrame(animate);
                if (controls) controls.update(); // only required if controls.enableDamping = true, or if controls.autoRotate = true
                renderer.render(scene, camera);
            }
        }

        // create Custom model
        function init_custom(chassisSize = [8, 5, 2], radius = 1) {
            var container = document.getElementById('custom');
            var scene = new THREE.Scene();
            scene.background = new THREE.Color(0xbbdefb);

            var camera = new THREE.PerspectiveCamera(60, container.clientWidth / container.clientHeight, 1, 1000);
            camera.position.set(20, 20, 8);
            camera.up.set(0, 0, 1);
            scene.add(camera);
            window.addEventListener('resize', () => {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
            });

            const ground = new THREE.PlaneGeometry(20, 20, 4, 4);
            const ground_material = new THREE.MeshStandardMaterial({ color: 0xccf0cc });
            const ground_mesh = new THREE.Mesh(ground, ground_material);
            ground_mesh.castShadow = true;
            ground_mesh.receiveShadow = true;
            scene.add(ground_mesh);

            const dirLight1 = new THREE.DirectionalLight(0xffffff);
            dirLight1.position.set(1, 1, 1);
            scene.add(dirLight1);
            const ambientLight = new THREE.AmbientLight(0x222222);
            scene.add(ambientLight);

            const dirLight3 = new THREE.DirectionalLight(0xfffff0, 0.4, 1);
            dirLight3.position.set(3, 12, 15);
            dirLight3.castShadow = true;
            dirLight3.shadow.camera.near = 0.1;
            dirLight3.shadow.camera.far = 500;
            dirLight3.shadow.camera.right = 32;
            dirLight3.shadow.camera.left = - 32;
            dirLight3.shadow.camera.top = 32;
            dirLight3.shadow.camera.bottom = - 32;
            dirLight3.shadow.mapSize.width = 512;
            dirLight3.shadow.mapSize.height = 512;
            dirLight3.shadow.radius = 4;
            dirLight3.shadow.bias = - 0.0005;
            scene.add(dirLight3);

            var group = new THREE.Group();


            var geometry = new THREE.BoxGeometry(chassisSize[0], chassisSize[1], chassisSize[2]);
            var material = new THREE.MeshLambertMaterial({ color: 0xC56183 });
            var chassisMesh = new THREE.Mesh(geometry, material);
            chassisMesh.castShadow = true;
            chassisMesh.receiveShadow = true;
            chassisMesh.position.set(0, 0, chassisSize[2] / 2 + radius);
            // chassisMesh.position.set(0, 0, 2 + radius);

            group.add(chassisMesh);

            function gen_wheel(...pos) {
                var geometry = new THREE.CylinderGeometry(radius, radius, radius / 2, 20);
                var material = new THREE.MeshPhongMaterial({ color: 0x483434 });
                var wheelMesh = new THREE.Mesh(geometry, material);
                wheelMesh.geometry.rotateX(Math.PI);
                wheelMesh.castShadow = true;
                wheelMesh.receiveShadow = true;
                wheelMesh.position.set(...pos);
                group.add(wheelMesh);
            }
            gen_wheel(-(chassisSize[0] / 2 - radius * 1.25), chassisSize[1] / 2, radius);
            gen_wheel((chassisSize[0] / 2 - radius * 1.25), chassisSize[1] / 2, radius);
            gen_wheel(-(chassisSize[0] / 2 - radius * 1.25), -chassisSize[1] / 2, radius);
            gen_wheel((chassisSize[0] / 2 - radius * 1.25), -chassisSize[1] / 2, radius);
            scene.add(group);

            var renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.VSMShadowMap;
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.innerHTML = "";
            container.appendChild(renderer.domElement);
            window.addEventListener('resize', () => {
                renderer.setSize(container.clientWidth, container.clientHeight);
            });
            var controls = new OrbitControls(camera, renderer.domElement);

            animate();
            function animate() {
                requestAnimationFrame(animate);
                if (controls) controls.update(); // only required if controls.enableDamping = true, or if controls.autoRotate = true
                renderer.render(scene, camera);
            }
        }

        init_formulaone();
        init_truck();
        init_custom();
        window.init_custom = init_custom;
    </script>

    <script>
        var customcar = {};
        function sendrender() {
            var length = document.getElementById("length").value;
            var width = document.getElementById("width").value;
            var height = document.getElementById("height").value;
            var radius = document.getElementById("radius").value;
            var mass = document.getElementById("mass").value;
            var force = document.getElementById("force").value;

            if (length && height && width) {
                length = parseFloat(length);
                width = parseFloat(width);
                height = parseFloat(height);
                radius = parseFloat(radius) || 1;
                mass = parseFloat(mass) || 1;
                force = parseFloat(force) || 1;

                init_custom([length, width, height], radius);
                customcar = { chassisColor: 0xC56183 , wheelColor: 0x483434, chassisSize:[length,height,width], wheelRadius: radius, mass: mass, maxForce: force };
            }
            // console.log(1);
        }

        function saveAndExport({ chassisColor, wheelColor, chassisSize, wheelRadius, mass, maxForce }) {
            var carDetail = { chassisColor, wheelColor, chassisSize, wheelRadius, mass, maxForce };
            console.log(carDetail);
            
            localStorage.setItem('carDetail', JSON.stringify(carDetail));
            window.location.href = '/simulator.html';
        }

    </script>

    <!----------------- THREE JS -------------------->
    <h1 class="heading"> Choose your vehicle</h1>
    <div class="container">
        <div class="carpic" id="formulaone"></div>
        <div class="carpic" id="truck"></div>
        <div class="carpic" id="custom"></div>
    </div>

    <!----------------- Info -------------------->
    <div class="container" style="margin-top: 20px;">
        <div class="info">
            <h2 style="text-align: center;">FormulaOne</h2>
            <p class="text">Chassis-Size : <br> L = 8 , W = 5 , H = 2</p>
            <p class="text">Wheel-radius : 1 m</p>
            <p class="text">Mass : 500 kg</p>
            <p class="text">Engine-force : 8,000 N</p>
            <br>
            <div class="text-center">
                <button onclick="saveAndExport({ chassisColor: 0xfec89a , wheelColor: 0xEED6C4, chassisSize:[8,2,5], wheelRadius: 1, mass: 500, maxForce: 8000/4 })" class="btselect">SELECT</button>
            </div>

        </div>

        <div class="info">
            <h2 style="text-align: center;">Truck</h2>
            <p class="text">Chassis-Size : <br> L = 12 , W = 5 , H = 5</p>
            <p class="text">Wheel-radius : 2.2 m</p>
            <p class="text">Mass : 1000 kg</p>
            <p class="text">Engine-force : 10,000 N</p>
            <br>
            <div class="text-center">
                <button onclick="saveAndExport({ chassisColor: 0xfffff8 , wheelColor: 0x000000, chassisSize:[12,5,5], wheelRadius: 2.2, mass: 1000, maxForce: 10000/4 })" class="btselect">SELECT</button>
            </div>
        </div>

        <div class="info">
            <h2 style="text-align: center;">( CUSTOM )</h2>
            <form onsubmit="sendrender()" onchange="sendrender()" class="custom-form">
                <input type="number" id="length" placeholder="Length"><br><br>
                <input type="number" id="width" placeholder="Width"><br><br>
                <input type="number" id="height" placeholder="Height"><br><br>
                <input type="number" id="radius" placeholder="Wheel-radius"><br><br>
                <input type="number" id="mass" placeholder="Mass"><br><br>
                <input type="number" id="force" placeholder="Engine-force"><br><br>
            </form>
            <div class="text-center">
                <button onclick="saveAndExport(customcar)" class="btselect">SELECT</button>

            </div>
        </div>

    </div>

</body>

</html>